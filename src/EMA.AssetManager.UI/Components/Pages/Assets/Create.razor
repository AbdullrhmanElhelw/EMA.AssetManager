@page "/assets/create"
@using EMA.AssetManager.Domain.Enums
@namespace EMA.AssetManager.UI.Pages.Assets

<PageTitle>إضافة عهدة جديدة</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4 mb-4">
    <div class="d-flex align-center mb-6">
        <MudIconButton Icon="@Icons.Material.Filled.ArrowForward" Color="Color.Inherit" OnClick="Cancel" Class="me-3" />
        <div>
            <MudText Typo="Typo.h5" Class="font-bold">توريد عهدة جديدة</MudText>
            <MudText Typo="Typo.body2" Color="Color.Secondary">تسجيل بيانات السيريال والمخزن وتاريخ الشراء</MudText>
        </div>
    </div>

    <MudPaper Elevation="3" Class="pa-6 rounded-lg" Style="border-top: 4px solid var(--mud-palette-secondary);">
        <MudForm @ref="_form" Model="@_model">
            <MudGrid Spacing="4">

                <MudItem xs="12" md="6">
                    <MudSelect T="Guid ?" Label="الصنف" Variant="Variant.Outlined"
                               @bind-Value="_selectedItemId"
                               AnchorOrigin="Origin.BottomCenter" TransformOrigin="Origin.TopCenter"
                               Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Devices"
                               Clearable="true"
                               Placeholder="-- اختر الصنف --"
                               Required="true" RequiredError="يجب اختيار الصنف">
                        @foreach (var item in _items)
                        {
                            <MudSelectItem Value="@((Guid?)item.Id)">
                                <div class="d-flex justify-space-between w-100">
                                    <MudText>@item.Name</MudText>
                                    <MudText Typo="Typo.caption" Color="Color.Secondary">@item.Code</MudText>
                                </div>
                            </MudSelectItem>
                        }
                    </MudSelect>
                </MudItem>

                <MudItem xs="12" md="6">
                    <MudSelect T="Guid ?" Label="المخزن المستلم" Variant="Variant.Outlined"
                               @bind-Value="_selectedWarehouseId"
                               AnchorOrigin="Origin.BottomCenter" TransformOrigin="Origin.TopCenter"
                               Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Store"
                               Clearable="true"
                               Placeholder="-- اختر المخزن --"
                               Required="true" RequiredError="يجب اختيار المخزن">
                        @foreach (var w in _warehouses)
                        {
                            <MudSelectItem Value="@((Guid?)w.Id)">@w.Name</MudSelectItem>
                        }
                    </MudSelect>
                </MudItem>

                <MudItem xs="12"><MudDivider /></MudItem>

                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="_model.SerialNumber" Label="السيريال نمبر (S/N)" Variant="Variant.Outlined"
                                  Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.QrCode"
                                  Required="true" RequiredError="السيريال مطلوب"
                                  HelperText="يجب أن يكون فريداً وغير مكرر" />
                </MudItem>

                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="_model.Barcode" Label="الباركود (اختياري)" Variant="Variant.Outlined"
                                  Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.QrCodeScanner" />
                </MudItem>

                <MudItem xs="12" md="4">
                    <MudSelect T="AssetStatus" Label="الحالة الأولية" Variant="Variant.Outlined"
                               @bind-Value="_model.Status"
                               AnchorOrigin="Origin.BottomCenter" TransformOrigin="Origin.TopCenter"
                               Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Info">
                        @foreach (AssetStatus status in Enum.GetValues(typeof(AssetStatus)))
                        {
                            <MudSelectItem Value="@status">@GetStatusName(status)</MudSelectItem>
                        }
                    </MudSelect>
                </MudItem>

                <MudItem xs="12" md="4">
                    <MudDatePicker Label="تاريخ الشراء" Editable="true" @bind-Date="_model.PurchaseDate"
                                   Variant="Variant.Outlined" Placeholder="يوم/شهر/سنة"
                                   Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.CalendarToday"
                                   DisableToolbar="true" />
                </MudItem>

                <MudItem xs="12" md="4">
                    <MudDatePicker Label="تاريخ انتهاء الضمان" Editable="true" @bind-Date="_model.ExpiryDate"
                                   Variant="Variant.Outlined" Placeholder="يوم/شهر/سنة"
                                   Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.VerifiedUser"
                                   DisableToolbar="true" />
                </MudItem>

            </MudGrid>

            <MudDivider Class="my-6" />

            <div class="d-flex justify-end gap-2">
                <MudButton OnClick="Cancel" Variant="Variant.Outlined" Color="Color.Secondary">إلغاء</MudButton>
                <MudButton OnClick="Submit" Variant="Variant.Filled" Color="Color.Primary" Disabled="@_processing" StartIcon="@Icons.Material.Filled.Save">
                    @if (_processing)
                    {
                        <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="ms-2" />
                        <span>جاري الحفظ...</span>
                    }
                    else
                    {
                        <text>حفظ وإضافة</text>
                    }
                </MudButton>
            </div>
        </MudForm>
    </MudPaper>
</MudContainer>